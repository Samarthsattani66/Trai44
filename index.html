<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live TV Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0b1220; }
.card:hover img { transform: scale(1.08); }
.card img { transition: 0.3s; }
.glass { backdrop-filter: blur(10px); background: rgba(15,23,42,.7); }
</style>
</head>

<body class="text-white">

<!-- HEADER -->
<header class="glass sticky top-0 z-50 border-b border-white/10">
  <div class="max-w-7xl mx-auto p-4 flex items-center justify-between">
    <div>
      <h1 class="text-xl font-bold">Live Channels</h1>
      <p class="text-xs text-slate-300">Upload M3U • Auto Sections</p>
    </div>

    <label class="cursor-pointer bg-cyan-500/20 px-4 py-2 rounded-xl border border-cyan-400/30 hover:bg-cyan-500/30">
      Upload M3U
      <input type="file" accept=".m3u,.m3u8" id="fileInput" hidden>
    </label>
  </div>

  <!-- TABS -->
  <div id="tabs" class="flex gap-2 px-4 pb-3 overflow-x-auto"></div>
</header>

<!-- GRID -->
<main class="max-w-7xl mx-auto p-4">
  <div id="meta" class="text-sm text-slate-400 mb-3"></div>
  <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>

  <div id="empty" class="hidden text-center text-slate-400 mt-20">
    Upload an M3U playlist to begin
  </div>
</main>

<!-- MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
  <div class="bg-slate-950 rounded-xl max-w-lg w-full border border-white/10">
    <div class="p-4 border-b border-white/10 flex justify-between">
      <div>
        <h3 id="modalTitle" class="font-semibold"></h3>
        <p class="text-xs text-slate-400">Open in external player</p>
      </div>
      <button onclick="closeModal()">✕</button>
    </div>

    <div class="p-4 space-y-3">
      <div class="text-xs text-slate-400 break-all" id="streamUrl"></div>

      <button onclick="playExternal()"
        class="w-full bg-cyan-500/20 border border-cyan-400/30 py-2 rounded-xl hover:bg-cyan-500/30">
        ▶ Play
      </button>
    </div>
  </div>
</div>

<script>
const grid = document.getElementById("grid");
const tabs = document.getElementById("tabs");
const empty = document.getElementById("empty");
const meta = document.getElementById("meta");

const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const streamUrlEl = document.getElementById("streamUrl");

const PLAYER = "https://teamrom3u8plyr2.pages.dev/?url=";

let channels = [];
let activeSection = "All";
let currentUrl = "";

/* FILE UPLOAD */
document.getElementById("fileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => parseM3U(reader.result);
  reader.readAsText(file);
});

/* PARSE M3U */
function parseM3U(data) {
  channels = [];
  let temp = {};

  data.split("\n").forEach(line => {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      temp = {};
      temp.title = line.split(",").pop();

      const logo = line.match(/tvg-logo="(.*?)"/);
      const group = line.match(/group-title="(.*?)"/);

      temp.logo = logo ? logo[1] : "";
      temp.section = group ? group[1] : "Other";
    }
    else if (line && !line.startsWith("#")) {
      temp.url = line;
      channels.push(temp);
    }
  });

  buildTabs();
  render();
}

/* TABS */
function buildTabs() {
  tabs.innerHTML = "";
  const sections = ["All", ...new Set(channels.map(c => c.section))];

  sections.forEach(sec => {
    const btn = document.createElement("button");
    btn.textContent = sec;
    btn.className = `px-3 py-1 rounded-xl text-sm border ${
      sec === activeSection
        ? "bg-cyan-500/20 border-cyan-400/30"
        : "bg-slate-900 border-white/10"
    }`;

    btn.onclick = () => {
      activeSection = sec;
      render();
    };

    tabs.appendChild(btn);
  });
}

/* GRID */
function render() {
  grid.innerHTML = "";
  const list = activeSection === "All"
    ? channels
    : channels.filter(c => c.section === activeSection);

  meta.textContent = `${list.length} channels`;
  empty.classList.toggle("hidden", list.length !== 0);

  list.forEach(ch => {
    const card = document.createElement("div");
    card.className = "card cursor-pointer";

    card.innerHTML = `
      <div class="rounded-xl overflow-hidden border border-white/10 bg-slate-900">
        <img src="${ch.logo || 'https://dummyimage.com/400x225/111827/ffffff&text=TV'}"
             class="w-full h-32 object-cover">
      </div>
      <p class="text-sm mt-1 truncate">${ch.title}</p>
    `;

    card.onclick = () => openModal(ch);
    grid.appendChild(card);
  });
}

/* MODAL */
function openModal(ch) {
  modal.classList.remove("hidden");
  modalTitle.textContent = ch.title;
  streamUrlEl.textContent = ch.url;
  currentUrl = ch.url;
}

function closeModal() {
  modal.classList.add("hidden");
}

function playExternal() {
  window.open(PLAYER + encodeURIComponent(currentUrl), "_blank");
}
</script>

</body>
</html>
