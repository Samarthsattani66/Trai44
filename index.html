<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Live Channels</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0b1220; }
.thumb { transition: transform .2s ease; }
.card:hover .thumb { transform: scale(1.05); }
</style>
</head>

<body class="text-slate-100">

<header class="p-4 border-b border-white/10">
  <h1 class="text-xl font-bold">Live Channels</h1>
  <p class="text-xs text-slate-400">VIP Playlist • External Player</p>
</header>

<main class="p-4">
  <div id="status" class="text-sm text-slate-400 mb-4">Loading playlist…</div>
  <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
</main>

<script>
/* ================= CONFIG ================= */
const PLAYLIST_URL = "https://allinonereborn.xyz/playlist/vip.m3u";
const CORS_PROXY = "https://api.allorigins.win/raw?url="; // Free CORS proxy
const PLAYER_URL = "https://teamrom3u8plyr2.pages.dev/?url=";

/* ================= HELPERS ================= */
function getAttr(line, key) {
  const m = line.match(new RegExp(key + '="([^"]*)"', "i"));
  return m ? m[1] : "";
}

/* ================= PARSER ================= */
function parseM3U(text) {
  const lines = text.split(/\r?\n/);
  const channels = [];
  let current = null;

  for (const line of lines) {
    if (line.startsWith("#EXTINF")) {
      current = {
        name: line.split(",").pop().trim(),
        logo: getAttr(line, "tvg-logo"),
        group: getAttr(line, "group-title")
      };
    } else if (line && !line.startsWith("#") && current) {
      current.url = line.trim();
      channels.push(current);
      current = null;
    }
  }
  return channels;
}

/* ================= LOAD PLAYLIST ================= */
async function loadPlaylist() {
  try {
    const res = await fetch(CORS_PROXY + encodeURIComponent(PLAYLIST_URL));
    const text = await res.text();
    const channels = parseM3U(text);

    document.getElementById("status").textContent =
      `Loaded ${channels.length} channels`;

    renderChannels(channels);
  } catch (err) {
    document.getElementById("status").textContent =
      "Failed to load playlist. Proxy may be down.";
    console.error(err);
  }
}

/* ================= RENDER ================= */
function renderChannels(channels) {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  channels.forEach(ch => {
    const card = document.createElement("div");
    card.className = "card cursor-pointer";

    card.innerHTML = `
      <div class="rounded-xl overflow-hidden bg-slate-900 border border-white/10">
        <img class="thumb w-full h-32 object-cover"
          src="${ch.logo || 'https://dummyimage.com/400x225/111827/ffffff&text=LIVE'}"
          alt="${ch.name}">
      </div>
      <div class="mt-1 text-sm truncate">${ch.name}</div>
      <div class="text-xs text-slate-400 truncate">${ch.group || ""}</div>
    `;

    card.onclick = () => {
      window.open(
        PLAYER_URL + encodeURIComponent(ch.url),
        "_blank",
        "noopener,noreferrer"
      );
    };

    grid.appendChild(card);
  });
}

/* ================= INIT ================= */
loadPlaylist();
</script>

</body>
</html>
