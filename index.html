<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Live TV • OTT Style</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background:#0b1220;
  font-family: Inter, system-ui, Arial, sans-serif;
}

/* Card */
.card {
  width: 130px;
  flex-shrink: 0;
}
.card img {
  aspect-ratio: 16 / 9;
  object-fit: contain;
  background: #000;
  transition: transform .3s ease;
}
.card:hover img {
  transform: scale(1.05);
}

/* Section row */
.row {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding-bottom: 6px;
}
.row::-webkit-scrollbar {
  display: none;
}

/* Desktop */
@media (min-width: 768px) {
  .card {
    width: auto;
  }
  .row {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    overflow: visible;
  }
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-[#0b1220] px-4 py-3 border-b border-slate-800">
  <h1 class="text-lg font-semibold text-white mb-2">
    Live TV
  </h1>

  <input
    id="search"
    type="text"
    placeholder="Search channels..."
    class="w-full bg-slate-800 text-white px-4 py-2 rounded-lg outline-none focus:ring-2 focus:ring-blue-500"
  />
</header>

<!-- CONTENT -->
<main id="content" class="space-y-8 py-6"></main>

<script>
const M3U_URL = "https://allinonereborn.xyz/playlist/vip.m3u";
const PLAYER = "https://teamrom3u8plyr2.pages.dev/?url=";

const content = document.getElementById("content");
const searchInput = document.getElementById("search");

let channels = [];

/* LOAD M3U */
fetch(M3U_URL)
  .then(r => r.text())
  .then(parseM3U);

/* PARSE */
function parseM3U(data) {
  const lines = data.split("\n");
  let ch = {};

  lines.forEach(line => {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      ch = {};
      ch.title = line.split(",").pop();

      const logo = line.match(/tvg-logo="(.*?)"/);
      ch.logo = logo ? logo[1] : "";

      const group = line.match(/group-title="(.*?)"/);
      ch.group = group ? group[1].toLowerCase() : "";
    }

    if (line && !line.startsWith("#")) {
      ch.url = line;
      ch.section = getSection(ch.group, ch.title);
      if (ch.logo) channels.push(ch);
    }
  });

  renderAll(channels);
}

/* SECTION RULES */
function getSection(group, title) {
  title = title.toLowerCase();

  if (group.includes("cricket") || title.includes("cricket")) return "Cricket";
  if (group.includes("sport")) return "Sports";
  if (group.includes("india")) return "Indian TV";
  if (group.includes("movie")) return "Movies";
  if (group.includes("news")) return "News";
  if (group.includes("kids")) return "Kids";
  if (group.includes("music")) return "Music";
  if (group.includes("uk") || group.includes("usa")) return "International";

  return "Other";
}

/* RENDER ALL SECTIONS (NEVER REMOVES) */
function renderAll(list) {
  const sections = [
    "Cricket",
    "Sports",
    "Indian TV",
    "Movies",
    "News",
    "Kids",
    "Music",
    "International",
    "Other"
  ];

  content.innerHTML = "";

  sections.forEach(sec => {
    const items = list.filter(c => c.section === sec);
    if (!items.length) return;

    const section = document.createElement("section");
    section.innerHTML = `
      <h2 class="px-4 mb-3 text-base font-semibold text-slate-200">
        ${sec}
      </h2>
      <div class="row px-4">
        ${items.map(card).join("")}
      </div>
    `;
    content.appendChild(section);
  });
}

/* SEARCH (SAFE – DOES NOT BREAK SECTIONS) */
searchInput.addEventListener("input", () => {
  const q = searchInput.value.toLowerCase();

  if (!q) {
    renderAll(channels);
    return;
  }

  renderAll(
    channels.filter(c =>
      c.title.toLowerCase().includes(q)
    )
  );
});

/* CARD */
function card(ch) {
  return `
    <a href="${PLAYER + encodeURIComponent(ch.url)}"
       target="_blank"
       class="card">
      <div class="rounded-lg overflow-hidden bg-slate-800 shadow">
        <img src="${ch.logo}">
      </div>
      <p class="mt-1 text-xs text-slate-100 truncate">
        ${ch.title}
      </p>
    </a>
  `;
}
</script>

</body>
</html>
