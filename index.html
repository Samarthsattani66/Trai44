<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>IPL Match Player</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    video {
      width: 80%;
      max-width: 800px;
      margin-top: 20px;
    }
    select {
      margin-top: 10px;
      padding: 5px;
    }
  </style>
</head>
<body>

  <h1>IPL Live Match Player</h1>
  <video id="video" controls autoplay></video>
  <select id="qualitySelect"></select>

  <script>
    async function initPlayer() {
      const response = await fetch('https://raw.githubusercontent.com/drmlive/willow-live-events/refs/heads/main/willow.json');
      const json = await response.json();

      const playbackData = json.playback_data;
      if (!playbackData || playbackData.length === 0) {
        alert("No streams available.");
        return;
      }

      // Pick the first stream URL (you can customize this logic)
      const streamUrl = playbackData[0].url;

      const video = document.getElementById('video');
      const player = new shaka.Player(video);

      player.addEventListener('error', onError);

      try {
        await player.load(streamUrl);
        console.log('The video has now been loaded!');
        setupQualitySelector(player);
      } catch (e) {
        onError(e);
      }
    }

    function setupQualitySelector(player) {
      const qualitySelect = document.getElementById('qualitySelect');
      qualitySelect.innerHTML = ''; // clear existing options

      const tracks = player.getVariantTracks();
      tracks.forEach((track, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.text = `${track.height}p (${track.bandwidth / 1000} kbps)`;
        qualitySelect.appendChild(option);
      });

      qualitySelect.addEventListener('change', () => {
        const selectedTrack = tracks[qualitySelect.value];
        player.configure({ abr: { enabled: false } }); // disable auto
        player.selectVariantTrack(selectedTrack, /* clearBuffer= */ true);
      });
    }

    function onError(error) {
      console.error('Error code', error.code, 'object', error);
    }

    document.addEventListener('DOMContentLoaded', initPlayer);
  </script>
</body>
</html>
