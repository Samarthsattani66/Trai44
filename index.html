<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hotstar Style M3U Player</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  background:#0f172a;
  font-family: Arial, sans-serif;
}
.card:hover img {
  transform: scale(1.08);
}
.card img {
  transition: 0.3s;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="p-4 text-white text-2xl font-bold">
  Live Channels
</div>

<!-- CHANNEL GRID -->
<div id="grid" class="p-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>

<!-- PLAYER MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
  <div class="bg-black w-full max-w-4xl p-3 rounded">
    <video id="player" controls class="w-full h-[420px] bg-black"></video>
    <button onclick="closePlayer()" class="mt-2 bg-red-600 px-4 py-1 text-white rounded">
      Close
    </button>
  </div>
</div>

<script>
const M3U_URL = "https://allinonereborn.xyz/playlist/vip.m3u";
const grid = document.getElementById("grid");
const modal = document.getElementById("modal");
const video = document.getElementById("player");
let hls;

fetch(M3U_URL)
  .then(res => res.text())
  .then(parseM3U)
  .catch(err => console.error("M3U Error:", err));

function parseM3U(data) {
  const lines = data.split("\n");
  let channel = {};

  lines.forEach(line => {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      channel = {};
      channel.title = line.split(",").pop();

      const logoMatch = line.match(/tvg-logo="(.*?)"/);
      channel.logo = logoMatch ? logoMatch[1] : "";
    }

    if (line && !line.startsWith("#")) {
      channel.url = line;
      if (channel.logo) createCard(channel);
    }
  });
}

function createCard(ch) {
  const card = document.createElement("div");
  card.className = "card cursor-pointer";

  card.innerHTML = `
    <div class="overflow-hidden rounded-lg bg-gray-800">
      <img src="${ch.logo}" class="w-full h-40 object-cover">
    </div>
    <p class="text-white text-sm mt-1 truncate">${ch.title}</p>
  `;

  card.onclick = () => playStream(ch.url);
  grid.appendChild(card);
}

function playStream(url) {
  modal.classList.remove("hidden");

  if (hls) hls.destroy();

  if (Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else {
    video.src = url;
    video.play();
  }
}

function closePlayer() {
  modal.classList.add("hidden");
  video.pause();
  video.src = "";
  if (hls) hls.destroy();
}
</script>

</body>
</html>
