<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willow Live Events Player</title>
    <style>
        /* [Keep your existing CSS unchanged] */
    </style>
</head>
<body>
    <!-- [Keep your existing HTML structure unchanged] -->

    <script>
        // Updated Configuration
        const CONFIG = {
            MAX_RETRIES: 3,  // Matches their retry count
            RETRY_DELAY: 2000, // Matches their 2s timeout
            PLAYER_URL: "https://cdn.jsdelivr.net/gh/drmlive/willow-live-events@latest/player.html",
            CLOUDFRONT_ENDPOINTS: [
                "https://d2s2kf6q1n2zq5.cloudfront.net",
                "https://d3aq8i5c6s5m69.cloudfront.net"
            ],
            DRM: {
                widevine: "https://license.willow.tv/widevine",
                playready: "https://license.willow.tv/playready",
                clearkey: {
                    "3d5a7b8e2c1f4a9d": "a1b2c3d4e5f6g7h8" // Sample key
                }
            }
        };

        // [Keep your existing state variables and DOM references]

        async function getStreamData() {
            updateStatus("Fetching stream info...");
            
            try {
                // Their CloudFront-first selection logic
                const cloudfrontStreams = await getCloudFrontStreams();
                if (cloudfrontStreams.length === 0) {
                    throw new Error("No CloudFront streams available");
                }

                // Their priority sorting (bitrate > resolution)
                const selectedStream = cloudfrontStreams
                    .sort((a, b) => b.bitrate - a.bitrate)[0];

                return { 
                    url: selectedStream.url,
                    key: selectedStream.keyId || ''
                };
            } catch (error) {
                throw error;
            }
        }

        async function getCloudFrontStreams() {
            // Simulating their stream selection from multiple CloudFront endpoints
            const availableStreams = [];
            
            for (const endpoint of CONFIG.CLOUDFRONT_ENDPOINTS) {
                try {
                    const streams = await fetchStreamManifest(endpoint);
                    availableStreams.push(...streams.filter(s => 
                        s.url.includes('.mpd') && 
                        s.cdn === 'cloudfront'
                    ));
                } catch (e) {
                    console.warn(`Endpoint ${endpoint} failed: ${e.message}`);
                }
            }
            
            return availableStreams;
        }

        async function fetchStreamManifest(endpoint) {
            // Their actual implementation would make an API call here
            // This is a simplified version
            const mockResponse = {
                streams: [
                    {
                        url: `${endpoint}/high.mpd`,
                        bitrate: 8000000,
                        resolution: "1080p",
                        cdn: "cloudfront",
                        keyId: "3d5a7b8e2c1f4a9d"
                    },
                    {
                        url: `${endpoint}/medium.mpd`,
                        bitrate: 4000000,
                        resolution: "720p",
                        cdn: "cloudfront"
                    }
                ]
            };
            return mockResponse.streams;
        }

        function playStream(url, key) {
            return new Promise((resolve, reject) => {
                // Their player initialization with DRM config
                const playerConfig = {
                    url: encodeURIComponent(btoa(url)),
                    drm: JSON.stringify(CONFIG.DRM),
                    key: encodeURIComponent(btoa(key || ''))
                };
                
                const iframe = document.createElement('iframe');
                iframe.src = `${CONFIG.PLAYER_URL}?${new URLSearchParams(playerConfig)}`;
                
                // [Keep your existing iframe handlers]
            });
        }

        // [Keep all other existing functions unchanged]
    </script>
</body>
</html>
