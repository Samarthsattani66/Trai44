<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clappr Player with DRM and Quality Selector</title>
  <style>
    #player {
      width: 100%;
      height: 500px;
    }
    .quality-selector {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      padding: 5px;
    }
  </style>
</head>
<body>

  <!-- Player Container -->
  <div id="player"></div>

  <!-- Clappr & Shaka Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clappr-shaka-playback@latest/dist/clappr-shaka-playback.min.js"></script>

  <script>
    let shakaInstance = null;

    // Quality Selector Plugin
    const QualitySelectorPlugin = Clappr.UIContainerPlugin.extend({
      name: 'quality_selector',
      bindEvents() {
        this.listenTo(this.container, Clappr.Events.CONTAINER_PLAY, this.addSelector);
      },
      addSelector() {
        if (!shakaInstance || this.added) return;

        const select = document.createElement('select');
        select.className = 'quality-selector';
        select.title = 'Select Quality';

        const autoOption = document.createElement('option');
        autoOption.value = 'auto';
        autoOption.text = 'Auto';
        select.appendChild(autoOption);

        const tracks = shakaInstance.getVariantTracks();
        tracks.forEach(track => {
          const option = document.createElement('option');
          option.value = track.id;
          option.text = `${track.height}p (${Math.round(track.bandwidth / 1000)} kbps)`;
          select.appendChild(option);
        });

        select.onchange = function () {
          if (select.value === 'auto') {
            shakaInstance.configure({ abr: { enabled: true } });
          } else {
            const track = tracks.find(t => t.id == select.value);
            if (track) {
              shakaInstance.configure({ abr: { enabled: false } });
              shakaInstance.selectVariantTrack(track, true);
            }
          }
        };

        document.body.appendChild(select);
        this.added = true;
      }
    });

    // Initialize Player
    const player = new Clappr.Player({
      parentId: '#player',
      source: 'https://streamdog.site/proxy/noob/stream.php/linearjitp-playback.astro.com.my/dash-wv/linear/2504/default_ott.mpd',
      autoPlay: true,
      mute: false,
      plugins: [DashShakaPlayback, QualitySelectorPlugin],
      shakaConfiguration: {
        drm: {
          clearKeys: {
            '03c2e0af2f8159f9f0ce9b5dbc865f10': 'cd84ed136b0cc71f8ab8cd4d4f6a2e4c'
          }
        }
      },
      events: {
        onReady: function () {
          shakaInstance = player.getPlayback().shakaPlayer;
        }
      }
    });
  </script>
</body>
</html>
