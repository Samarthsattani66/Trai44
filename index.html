<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>M3U External Player Grid</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background:#0f172a;
  font-family: Arial, sans-serif;
}
.card:hover img {
  transform: scale(1.08);
}
.card img {
  transition: 0.3s;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="p-4 text-white text-2xl font-bold">
  Live Channels
</div>

<!-- CATEGORY FILTER -->
<div id="categories" class="px-4 pb-2 flex gap-2 flex-wrap"></div>

<!-- CHANNEL GRID -->
<div id="grid"
class="p-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
</div>

<script>
const M3U_URL = "https://allinonereborn.xyz/playlist/vip.m3u";
const EXTERNAL_PLAYER = "https://teamrom3u8plyr2.pages.dev/?url=";

const grid = document.getElementById("grid");
const categoriesDiv = document.getElementById("categories");

let channels = [];

/* FETCH M3U */
fetch(M3U_URL)
  .then(res => res.text())
  .then(parseM3U)
  .catch(err => console.error("M3U Error:", err));

/* PARSE M3U */
function parseM3U(data) {
  const lines = data.split("\n");
  let channel = {};

  lines.forEach(line => {
    line = line.trim();

    if (line.startsWith("#EXTINF")) {
      channel = {};
      channel.title = line.split(",").pop();

      const logoMatch = line.match(/tvg-logo="(.*?)"/);
      channel.logo = logoMatch ? logoMatch[1] : "";

      const groupMatch = line.match(/group-title="(.*?)"/);
      channel.group = groupMatch ? groupMatch[1].toLowerCase() : "";
    }

    if (line && !line.startsWith("#")) {
      channel.url = line;

      // CATEGORY LOGIC (OPENLY WRITTEN)
      if (channel.group.includes("jio")) {
        channel.category = "Jio TV+";
      } else {
        channel.category = "App";
      }

      if (channel.logo) channels.push(channel);
    }
  });

  renderCategories();
  renderChannels("All");
}

/* CATEGORY BUTTONS */
function renderCategories() {
  const cats = ["All", "Jio TV+", "App"];

  categoriesDiv.innerHTML = "";

  cats.forEach(cat => {
    const btn = document.createElement("button");
    btn.innerText = cat;
    btn.className =
      "bg-gray-700 text-white px-3 py-1 rounded text-sm hover:bg-blue-600";
    btn.onclick = () => renderChannels(cat);
    categoriesDiv.appendChild(btn);
  });
}

/* RENDER GRID */
function renderChannels(filter) {
  grid.innerHTML = "";

  channels
    .filter(ch => filter === "All" || ch.category === filter)
    .forEach(createCard);
}

/* CHANNEL CARD (CLICK = EXTERNAL PLAYER) */
function createCard(ch) {
  const card = document.createElement("a");
  card.href = EXTERNAL_PLAYER + encodeURIComponent(ch.url);
  card.target = "_blank";
  card.className = "card block";

  card.innerHTML = `
    <div class="overflow-hidden rounded-lg bg-gray-800">
      <img src="${ch.logo}"
        class="w-full h-40 object-cover">
    </div>

    <p class="text-white text-sm mt-1 truncate">
      ${ch.title}
    </p>
  `;

  grid.appendChild(card);
}
</script>

</body>
</html>
